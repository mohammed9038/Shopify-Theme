{%- comment -%}
  Professional Mobile Navigation Drawer
  Full-screen mobile navigation with animations and nested menus
{%- endcomment -%}

{%- liquid
  assign menu = section.settings.menu
  assign menu_items = linklists[menu].links
  assign show_mobile_menu = section.settings.enable_mobile_menu
  assign enable_mobile_search = section.settings.enable_mobile_search
  assign show_social_links = section.settings.show_social_links_mobile
-%}

{%- if show_mobile_menu -%}
  <div class="mobile-menu-overlay" aria-hidden="true"></div>
  
  <div id="mobile-menu-drawer" 
       class="mobile-menu-drawer" 
       role="dialog" 
       aria-modal="true" 
       aria-labelledby="mobile-menu-title"
       aria-hidden="true">
    
    <div class="mobile-menu-drawer__header">
      <h2 id="mobile-menu-title" class="mobile-menu-drawer__title visually-hidden">
        {{ 'sections.header.mobile_menu' | t }}
      </h2>
      
      {%- if section.settings.show_logo_mobile_menu -%}
        <div class="mobile-menu-drawer__logo">
          {%- if settings.logo != blank -%}
            <img src="{{ settings.logo | image_url: width: 120 }}"
                 alt="{{ shop.name }}"
                 width="120"
                 height="{{ 120 | divided_by: settings.logo.aspect_ratio | round }}"
                 loading="lazy">
          {%- else -%}
            <span class="mobile-menu-drawer__logo-text">{{ shop.name }}</span>
          {%- endif -%}
        </div>
      {%- endif -%}
      
      <button type="button" 
              class="mobile-menu-drawer__close" 
              aria-label="{{ 'general.common.close' | t }}">
        {%- render 'icon-close' -%}
      </button>
    </div>
    
    {%- if enable_mobile_search -%}
      <div class="mobile-menu-drawer__search">
        <form action="{{ routes.search_url }}" 
              method="get" 
              class="search-form"
              role="search">
          <div class="search-form__input-wrapper">
            <input type="search"
                   name="q"
                   value="{{ search.terms | escape }}"
                   placeholder="{{ 'general.search.placeholder' | t }}"
                   class="search-form__input"
                   aria-label="{{ 'general.search.search' | t }}">
            <button type="submit" 
                    class="search-form__submit"
                    aria-label="{{ 'general.search.submit' | t }}">
              {%- render 'icon-search' -%}
            </button>
          </div>
        </form>
      </div>
    {%- endif -%}
    
    <div class="mobile-menu-drawer__content">
      {%- if menu_items.size > 0 -%}
        <nav class="mobile-navigation" role="navigation" aria-label="{{ 'sections.header.navigation' | t }}">
          <ul class="mobile-navigation__list" role="list">
            {%- for link in menu_items -%}
              {%- liquid
                assign has_children = false
                if link.links.size > 0
                  assign has_children = true
                endif
                
                assign link_classes = 'mobile-navigation__link'
                if link.current
                  assign link_classes = link_classes | append: ' mobile-navigation__link--current'
                endif
              -%}
              
              <li class="mobile-navigation__item{% if has_children %} mobile-navigation__item--has-children{% endif %}">
                {%- if has_children -%}
                  <details class="mobile-navigation__dropdown">
                    <summary class="{{ link_classes }} mobile-navigation__link--dropdown">
                      {{ link.title }}
                      <span class="mobile-navigation__dropdown-icon">
                        {%- render 'icon-chevron-down' -%}
                      </span>
                    </summary>
                    
                    <div class="mobile-navigation__submenu">
                      <ul class="mobile-navigation__sublist" role="list">
                        {%- for child_link in link.links -%}
                          <li class="mobile-navigation__subitem">
                            <a href="{{ child_link.url }}" 
                               class="mobile-navigation__sublink{% if child_link.current %} mobile-navigation__sublink--current{% endif %}"
                               {% if child_link.current %}aria-current="page"{% endif %}>
                              {{ child_link.title }}
                            </a>
                          </li>
                        {%- endfor -%}
                      </ul>
                    </div>
                  </details>
                {%- else -%}
                  <a href="{{ link.url }}" 
                     class="{{ link_classes }}"
                     {% if link.current %}aria-current="page"{% endif %}>
                    {{ link.title }}
                  </a>
                {%- endif -%}
              </li>
            {%- endfor -%}
          </ul>
        </nav>
      {%- endif -%}
      
      {%- if section.settings.enable_mobile_account_links -%}
        <div class="mobile-menu-drawer__account">
          <h3 class="mobile-menu-drawer__section-title">{{ 'customer.account.title' | t }}</h3>
          <ul class="mobile-account-links" role="list">
            {%- if customer -%}
              <li>
                <a href="{{ routes.account_url }}" class="mobile-account-links__item">
                  {{ 'customer.account.title' | t }}
                </a>
              </li>
              <li>
                <a href="{{ routes.account_logout_url }}" class="mobile-account-links__item">
                  {{ 'customer.log_out' | t }}
                </a>
              </li>
            {%- else -%}
              <li>
                <a href="{{ routes.account_login_url }}" class="mobile-account-links__item">
                  {{ 'customer.login_page.title' | t }}
                </a>
              </li>
              <li>
                <a href="{{ routes.account_register_url }}" class="mobile-account-links__item">
                  {{ 'customer.register.title' | t }}
                </a>
              </li>
            {%- endif -%}
          </ul>
        </div>
      {%- endif -%}
      
      {%- if show_social_links and settings.social_twitter_link != blank or settings.social_facebook_link != blank or settings.social_pinterest_link != blank or settings.social_instagram_link != blank -%}
        <div class="mobile-menu-drawer__social">
          <h3 class="mobile-menu-drawer__section-title">{{ 'layout.footer.social' | t }}</h3>
          {%- render 'social-icons', class: 'mobile-social-icons' -%}
        </div>
      {%- endif -%}
    </div>
  </div>
{%- endif -%}

{%- style -%}
  .mobile-menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
    opacity: 0;
    visibility: hidden;
    transition: all var(--duration-default) ease;
  }
  
  .menu-open .mobile-menu-overlay {
    opacity: 1;
    visibility: visible;
  }
  
  .mobile-menu-drawer {
    position: fixed;
    top: 0;
    right: -100%;
    width: min(400px, 90vw);
    height: 100vh;
    background: var(--mobile-menu-bg, rgb(var(--color-background)));
    z-index: 1000;
    overflow-y: auto;
    transform: translateX(0);
    transition: right var(--duration-default) cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: -4px 0 20px rgba(0, 0, 0, 0.1);
  }
  
  .mobile-menu-drawer--open {
    right: 0;
  }
  
  .mobile-menu-drawer__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--mobile-menu-header-padding, 2rem);
    border-bottom: 1px solid rgba(var(--color-foreground), 0.1);
  }
  
  .mobile-menu-drawer__logo img {
    max-height: 40px;
    width: auto;
  }
  
  .mobile-menu-drawer__logo-text {
    font-size: 1.8rem;
    font-weight: 600;
    color: rgb(var(--color-foreground));
  }
  
  .mobile-menu-drawer__close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    border: none;
    background: transparent;
    border-radius: 50%;
    color: rgb(var(--color-foreground));
    cursor: pointer;
    transition: background-color var(--duration-short) ease;
  }
  
  .mobile-menu-drawer__close:hover {
    background: rgba(var(--color-foreground), 0.1);
  }
  
  .mobile-menu-drawer__close svg {
    width: 20px;
    height: 20px;
  }
  
  .mobile-menu-drawer__search {
    padding: var(--mobile-menu-search-padding, 2rem);
    border-bottom: 1px solid rgba(var(--color-foreground), 0.1);
  }
  
  .search-form__input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }
  
  .search-form__input {
    width: 100%;
    padding: 1.2rem 5rem 1.2rem 1.6rem;
    border: 1px solid rgba(var(--color-foreground), 0.2);
    border-radius: 2.4rem;
    background: transparent;
    font-size: 1.4rem;
    color: rgb(var(--color-foreground));
  }
  
  .search-form__input::placeholder {
    color: rgba(var(--color-foreground), 0.6);
  }
  
  .search-form__submit {
    position: absolute;
    right: 0.8rem;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border: none;
    background: rgb(var(--color-button));
    border-radius: 50%;
    color: rgb(var(--color-button-text));
    cursor: pointer;
    transition: all var(--duration-short) ease;
  }
  
  .search-form__submit:hover {
    transform: scale(1.05);
  }
  
  .mobile-menu-drawer__content {
    padding: var(--mobile-menu-content-padding, 2rem);
  }
  
  .mobile-navigation__list {
    margin: 0;
    padding: 0;
    list-style: none;
  }
  
  .mobile-navigation__item {
    border-bottom: 1px solid rgba(var(--color-foreground), 0.1);
  }
  
  .mobile-navigation__link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--mobile-nav-link-padding, 1.6rem 0);
    color: rgb(var(--color-foreground));
    text-decoration: none;
    font-size: var(--mobile-nav-font-size, 1.6rem);
    font-weight: 500;
    transition: color var(--duration-short) ease;
    cursor: pointer;
    border: none;
    background: transparent;
    width: 100%;
    text-align: left;
  }
  
  .mobile-navigation__link:hover {
    color: rgb(var(--color-link));
  }
  
  .mobile-navigation__link--current {
    color: rgb(var(--color-link));
  }
  
  .mobile-navigation__dropdown-icon {
    display: flex;
    align-items: center;
    width: 16px;
    height: 16px;
    transition: transform var(--duration-short) ease;
  }
  
  .mobile-navigation__dropdown[open] .mobile-navigation__dropdown-icon {
    transform: rotate(180deg);
  }
  
  .mobile-navigation__submenu {
    padding-left: 2rem;
    max-height: 0;
    overflow: hidden;
    transition: max-height var(--duration-default) ease;
  }
  
  .mobile-navigation__dropdown[open] .mobile-navigation__submenu {
    max-height: 1000px;
  }
  
  .mobile-navigation__sublist {
    margin: 0;
    padding: 1rem 0;
    list-style: none;
  }
  
  .mobile-navigation__sublink {
    display: block;
    padding: 1rem 0;
    color: rgba(var(--color-foreground), 0.8);
    text-decoration: none;
    font-size: 1.4rem;
    transition: color var(--duration-short) ease;
  }
  
  .mobile-navigation__sublink:hover,
  .mobile-navigation__sublink--current {
    color: rgb(var(--color-link));
  }
  
  .mobile-menu-drawer__section-title {
    font-size: 1.4rem;
    font-weight: 600;
    color: rgb(var(--color-foreground));
    margin: 2rem 0 1rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }
  
  .mobile-account-links {
    margin: 0;
    padding: 0;
    list-style: none;
  }
  
  .mobile-account-links__item {
    display: block;
    padding: 1rem 0;
    color: rgb(var(--color-foreground));
    text-decoration: none;
    font-size: 1.4rem;
    transition: color var(--duration-short) ease;
  }
  
  .mobile-account-links__item:hover {
    color: rgb(var(--color-link));
  }
  
  .mobile-menu-drawer__social {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid rgba(var(--color-foreground), 0.1);
  }
  
  @media screen and (min-width: 750px) {
    .mobile-menu-drawer,
    .mobile-menu-overlay {
      display: none;
    }
  }
{%- endstyle -%}