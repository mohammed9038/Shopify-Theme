<link rel="stylesheet" href="{{ 'component-header-enhanced.css' | asset_url }}">

{%- liquid
  assign header_tag = 'header'
  if section.settings.sticky_header_type == 'always' or section.settings.sticky_header_type == 'on-scroll-up'
    assign header_tag = 'sticky-header'
  endif
-%}

<{{ header_tag }}
  {% if header_tag == 'sticky-header' %}
    data-sticky-type="{{ section.settings.sticky_header_type }}"
  {% endif %}
  class="enhanced-header-wrapper enhanced-header-wrapper--{{ section.settings.desktop_layout }}"
>
  <header class="enhanced-header">
    
    {%- if section.settings.desktop_layout == 'two-row' and section.settings.show_top_bar -%}
      <!-- Top Navigation Bar -->
      <div class="enhanced-top-bar">
        <div class="enhanced-container">
          {%- if section.settings.menu != blank -%}
            <nav class="enhanced-nav">
              <ul class="enhanced-menu">
                {%- for link in section.settings.menu.links -%}
                  <li class="enhanced-menu-item">
                    <a href="{{ link.url }}" class="enhanced-menu-link">
                      {{ link.title | escape }}
                    </a>
                  </li>
                {%- endfor -%}
              </ul>
            </nav>
          {%- endif -%}
        </div>
      </div>
    {%- endif -%}

    <!-- Main Header -->
    <div class="enhanced-main-header">
      <div class="enhanced-container">
        
        <!-- Left Section -->
        <div class="enhanced-header-left">
          {%- comment -%} Show logo on left for two-row layout, or when single-row with logo_position left {%- endcomment -%}
          {%- if section.settings.desktop_layout == 'two-row' -%}
            <div class="enhanced-logo">
              {%- if section.settings.logo != blank -%}
                <a href="{{ routes.root_url }}">
                  <img src="{{ section.settings.logo | image_url: width: section.settings.logo_width }}" alt="{{ shop.name }}" width="{{ section.settings.logo_width }}" height="auto">
                </a>
              {%- else -%}
                <a href="{{ routes.root_url }}" class="enhanced-logo-text">{{ shop.name }}</a>
              {%- endif -%}
            </div>
          {%- elsif section.settings.desktop_layout == 'single-row' and section.settings.logo_position == 'left' -%}
            <div class="enhanced-logo">
              {%- if section.settings.logo != blank -%}
                <a href="{{ routes.root_url }}">
                  <img src="{{ section.settings.logo | image_url: width: section.settings.logo_width }}" alt="{{ shop.name }}" width="{{ section.settings.logo_width }}" height="auto">
                </a>
              {%- else -%}
                <a href="{{ routes.root_url }}" class="enhanced-logo-text">{{ shop.name }}</a>
              {%- endif -%}
            </div>
          {%- endif -%}
          
          {%- comment -%} Only show navigation in left section for single-row layout {%- endcomment -%}
          {%- if section.settings.desktop_layout == 'single-row' and section.settings.menu != blank -%}
            <nav class="enhanced-nav enhanced-nav--single-row">
              <ul class="enhanced-menu">
                {%- for link in section.settings.menu.links -%}
                  <li class="enhanced-menu-item">
                    <a href="{{ link.url }}" class="enhanced-menu-link">
                      {{ link.title | escape }}
                    </a>
                  </li>
                {%- endfor -%}
              </ul>
            </nav>
          {%- endif -%}
        </div>

        <!-- Center Section -->
        <div class="enhanced-header-center">
          {%- comment -%} Only show logo in center for single-row layout when logo_position is center {%- endcomment -%}
          {%- if section.settings.desktop_layout == 'single-row' and section.settings.logo_position == 'center' -%}
            <div class="enhanced-logo">
              {%- if section.settings.logo != blank -%}
                <a href="{{ routes.root_url }}">
                  <img src="{{ section.settings.logo | image_url: width: section.settings.logo_width }}" alt="{{ shop.name }}" width="{{ section.settings.logo_width }}" height="auto">
                </a>
              {%- else -%}
                <a href="{{ routes.root_url }}" class="enhanced-logo-text">{{ shop.name }}</a>
              {%- endif -%}
            </div>
          {%- endif -%}
          
          {%- comment -%} Show search in center for two-row layout, or when search_position is center {%- endcomment -%}
          {%- assign show_center_search = false -%}
          {%- if section.settings.enable_search -%}
            {%- if section.settings.desktop_layout == 'two-row' -%}
              {%- assign show_center_search = true -%}
            {%- elsif section.settings.search_position == 'center' -%}
              {%- assign show_center_search = true -%}
            {%- endif -%}
          {%- endif -%}
          
          {%- if show_center_search -%}
            <div class="enhanced-search">
              <form action="{{ routes.search_url }}" method="get" role="search" class="enhanced-search-form">
                <input type="search" name="q" placeholder="{{ 'general.search.search' | t }}" class="enhanced-search-input">
                <button type="submit" class="enhanced-search-button">
                  <svg viewBox="0 0 20 20" class="enhanced-search-icon">
                    <path fill="currentColor" d="m18.366 16.95l-5.708-5.708a8.026 8.026 0 1 0-1.414 1.414l5.708 5.708a1 1 0 0 0 1.414-1.414ZM8 14A6 6 0 1 1 8 2a6 6 0 0 1 0 12Z"/>
                  </svg>
                </button>
              </form>
            </div>
          {%- endif -%}
        </div>

        <!-- Right Section -->
        <div class="enhanced-header-right">
          {%- if section.settings.search_position == 'right' and section.settings.enable_search -%}
            <div class="enhanced-search">
              <form action="{{ routes.search_url }}" method="get" role="search" class="enhanced-search-form">
                <input type="search" name="q" placeholder="{{ 'general.search.search' | t }}" class="enhanced-search-input">
                <button type="submit" class="enhanced-search-button">
                  <svg viewBox="0 0 20 20" class="enhanced-search-icon">
                    <path fill="currentColor" d="m18.366 16.95l-5.708-5.708a8.026 8.026 0 1 0-1.414 1.414l5.708 5.708a1 1 0 0 0 1.414-1.414ZM8 14A6 6 0 1 1 8 2a6 6 0 0 1 0 12Z"/>
                  </svg>
                </button>
              </form>
            </div>
          {%- endif -%}

          <div class="enhanced-icons">
            {%- if shop.customer_accounts_enabled and section.settings.enable_customer_avatar -%}
              <a href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}" class="enhanced-icon enhanced-icon--account">
                <svg viewBox="0 0 20 20" class="enhanced-icon-svg">
                  <path fill="currentColor" d="M17.1 16.9v-1a2 2 0 0 0-2-2H4.9a2 2 0 0 0-2 2v1a.5.5 0 0 0 1 0v-1a1 1 0 0 1 1-1h10.2a1 1 0 0 1 1 1v1a.5.5 0 0 0 1 0ZM10 2a4 4 0 1 0 0 8 4 4 0 0 0 0-8ZM7 6a3 3 0 1 1 6 0 3 3 0 0 1-6 0Z"/>
                </svg>
                <span class="enhanced-visually-hidden">Account</span>
              </a>
            {%- endif -%}

            <a href="{{ routes.cart_url }}" class="enhanced-icon enhanced-icon--cart" id="enhanced-cart-icon">
              <svg viewBox="0 0 20 20" class="enhanced-icon-svg">
                <path fill="currentColor" d="M8.5 19a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3ZM19 7h-3V6a4 4 0 0 0-8 0v1H5a1 1 0 0 0-1 1v9a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V8a1 1 0 0 0-1-1ZM10 3a3 3 0 0 1 3 3v1h-6V6a3 3 0 0 1 3-3ZM6 17V9h2v8H6Zm4 0V9h2v8h-2Zm4 0V9h2v8h-2Z"/>
              </svg>
              <span class="enhanced-visually-hidden">Cart</span>
              {%- if cart != empty -%}
                <span class="enhanced-cart-count">{{ cart.item_count }}</span>
              {%- endif -%}
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Header -->
    <div class="enhanced-mobile-header">
      <div class="enhanced-container">
        <button class="enhanced-mobile-menu-toggle" type="button">
          <span class="enhanced-hamburger">
            <span></span>
            <span></span>
            <span></span>
          </span>
          <span class="enhanced-visually-hidden">Menu</span>
        </button>

        <div class="enhanced-mobile-logo">
          {%- if section.settings.logo != blank -%}
            <a href="{{ routes.root_url }}">
              <img src="{{ section.settings.logo | image_url: width: 150 }}" alt="{{ shop.name }}" width="120" height="auto">
            </a>
          {%- else -%}
            <a href="{{ routes.root_url }}" class="enhanced-logo-text">{{ shop.name }}</a>
          {%- endif -%}
        </div>

        <div class="enhanced-mobile-icons">
          <a href="{{ routes.cart_url }}" class="enhanced-icon enhanced-icon--cart">
            <svg viewBox="0 0 20 20" class="enhanced-icon-svg">
              <path fill="currentColor" d="M8.5 19a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3ZM19 7h-3V6a4 4 0 0 0-8 0v1H5a1 1 0 0 0-1 1v9a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V8a1 1 0 0 0-1-1ZM10 3a3 3 0 0 1 3 3v1h-6V6a3 3 0 0 1 3-3ZM6 17V9h2v8H6Zm4 0V9h2v8h-2Zm4 0V9h2v8h-2Z"/>
            </svg>
            {%- if cart != empty -%}
              <span class="enhanced-cart-count">{{ cart.item_count }}</span>
            {%- endif -%}
          </a>
        </div>
      </div>
    </div>

  </header>
</{{ header_tag }}>

{% schema %}
{
  "name": "t:sections.header.name",
  "class": "section-header",
  "max_blocks": 3,
  "settings": [
    {
      "type": "select",
      "id": "desktop_layout",
      "label": "Desktop layout",
      "options": [
        {
          "value": "single-row",
          "label": "Single row"
        },
        {
          "value": "two-row",
          "label": "Two row"
        }
      ],
      "default": "two-row"
    },
    {
      "type": "checkbox",
      "id": "show_top_bar",
      "label": "Show top bar",
      "default": true
    },
    {
      "type": "select",
      "id": "logo_position",
      "label": "Logo position",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        }
      ],
      "default": "left"
    },
    {
      "type": "select",
      "id": "search_position",
      "label": "Search position",
      "options": [
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "select",
      "id": "mobile_logo_position",
      "label": "Mobile logo position",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        }
      ],
      "default": "center"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Menu"
    },
    {
      "type": "checkbox",
      "id": "enable_search",
      "default": true,
      "label": "Enable search"
    },
    {
      "type": "checkbox",
      "id": "enable_customer_avatar",
      "default": true,
      "label": "Enable customer account"
    },
    {
      "type": "select",
      "id": "sticky_header_type",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "on-scroll-up",
          "label": "On scroll up"
        },
        {
          "value": "always",
          "label": "Always"
        }
      ],
      "default": "on-scroll-up",
      "label": "Sticky header"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 300,
      "step": 10,
      "default": 150,
      "unit": "px",
      "label": "Logo width"
    }
  ]
}
{% endschema %}