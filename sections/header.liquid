{{ 'modern-header.css' | asset_url | stylesheet_tag }}

<style>
  :root {
    {% if section.settings.accent_color != blank %}
      --header-accent: {{ section.settings.accent_color }};
    {% endif %}
    
    {% if section.settings.header_height %}
      --header-main-height: {{ section.settings.header_height }}px;
    {% endif %}
    
    {% if section.settings.top_bar_height %}
      --header-top-height: {{ section.settings.top_bar_height }}px;
    {% endif %}
    
    {% if section.settings.font_size_navigation %}
      --header-nav-font-size: {{ section.settings.font_size_navigation }}px;
    {% endif %}
    
    {% if section.settings.font_weight_navigation %}
      --header-nav-font-weight: {{ section.settings.font_weight_navigation }};
    {% endif %}
    
    {% if section.settings.search_width == 'small' %}
      --search-bar-max-width: 400px;
    {% elsif section.settings.search_width == 'large' %}
      --search-bar-max-width: 700px;
    {% endif %}
  }
  
  {% unless section.settings.enable_shadow %}
    .header__main-bar {
      box-shadow: none;
    }
  {% endunless %}
  
  {% if section.settings.header_transparency == 'semi_transparent' %}
    .header {
      background: rgba(var(--color-background), 0.9);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
  {% elsif section.settings.header_transparency == 'transparent' %}
    .header {
      background: transparent;
      border-bottom: none;
    }
    .header__top-bar {
      background: rgba(var(--color-background), 0.1);
    }
  {% endif %}
  
  {% unless section.settings.show_top_bar %}
    .header__top-bar {
      display: none;
    }
    .header__main-container {
      grid-template-columns: 1fr 2fr 1fr;
    }
  {% endunless %}
</style>

{% comment %}
  Modern Two-Bar Header - Desktop & Mobile Responsive
{% endcomment %}

<script src="{{ 'details-disclosure.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'details-modal.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'cart-notification.js' | asset_url }}" defer="defer"></script>

{% if section.settings.enable_sticky_header %}
  <script src="{{ 'sticky-header.js' | asset_url }}" defer="defer"></script>
{% endif %}

{% assign sticky_class = '' %}
{% if section.settings.enable_sticky_header %}
  {% assign sticky_class = 'header--sticky' %}
{% endif %}

<header class="header {{ sticky_class }}" id="shopify-section-header">
  
  <!-- Desktop Two-Bar Layout -->
  <div class="header__desktop">
    
    <!-- Top Bar: Navigation Menu -->
    <div class="header__top-bar">
      <div class="header__top-container">
        <nav class="header__nav header__nav--top">
          <ul class="header__nav-list">
            {%- for link in section.settings.menu.links -%}
              <li class="header__nav-item">
                {%- if link.links != blank -%}
                  <details class="header__dropdown">
                    <summary class="header__nav-link header__nav-link--dropdown">
                      {{ link.title | escape }}
                      <svg class="header__dropdown-icon" viewBox="0 0 10 6" aria-hidden="true">
                        <path d="M1 1l4 4 4-4" stroke="currentColor" stroke-width="1.5" fill="none"/>
                      </svg>
                    </summary>
                    <div class="header__dropdown-content">
                      <ul class="header__dropdown-list">
                        {%- for childlink in link.links -%}
                          <li>
                            <a href="{{ childlink.url }}" class="header__dropdown-link{% if childlink.current %} header__dropdown-link--active{% endif %}">
                              {{ childlink.title | escape }}
                            </a>
                          </li>
                        {%- endfor -%}
                      </ul>
                    </div>
                  </details>
                {%- else -%}
                  <a href="{{ link.url }}" class="header__nav-link{% if link.current %} header__nav-link--active{% endif %}">
                    {{ link.title | escape }}
                  </a>
                {%- endif -%}
              </li>
            {%- endfor -%}
          </ul>
        </nav>
        
        <!-- Optional: Announcement/Promo Bar -->
        {% if section.settings.announcement_text != blank %}
          <div class="header__announcement">
            {{ section.settings.announcement_text }}
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Main Bar: Logo + Search + Actions -->
    <div class="header__main-bar">
      <div class="header__main-container">
        
        <!-- Logo (Left) -->
        <div class="header__logo">
          {% if section.settings.logo != blank %}
            <a href="{{ routes.root_url }}" class="header__logo-link">
              {%- assign logo_alt = section.settings.logo.alt | default: shop.name | escape -%}
              {%- assign logo_height = section.settings.logo_width | divided_by: section.settings.logo.aspect_ratio -%}
              {%- assign logo_url = section.settings.logo | image_url: width: section.settings.logo_width -%}
              <img 
                src="{{ logo_url }}"
                alt="{{ logo_alt }}"
                class="header__logo-image"
                width="{{ section.settings.logo_width }}"
                height="{{ logo_height | round }}"
                loading="eager"
              />
            </a>
          {% else %}
            <a href="{{ routes.root_url }}" class="header__logo-text">
              {{ shop.name }}
            </a>
          {% endif %}
        </div>

        <!-- Search Bar (Center) -->
        {% if section.settings.enable_search %}
          <div class="header__search-bar">
            <form action="{{ routes.search_url }}" method="get" class="header__search-form">
              <input
                type="search"
                name="q"
                value="{{ search.terms | escape }}"
                placeholder="{% if section.settings.search_placeholder != blank %}{{ section.settings.search_placeholder }}{% else %}{{ 'general.search.search' | t }}{% endif %}"
                class="header__search-input"
                aria-label="{{ 'general.search.search' | t }}"
              />
              <button type="submit" class="header__search-submit">
                <svg class="header__search-icon" viewBox="0 0 20 20" aria-hidden="true">
                  <path d="M8.5 3a5.5 5.5 0 0 1 4.383 8.823l3.896 3.896a.75.75 0 1 1-1.06 1.061l-3.897-3.896A5.5 5.5 0 1 1 8.5 3z" fill="currentColor"/>
                </svg>
              </button>
            </form>
          </div>
        {% endif %}

        <!-- Actions (Right): Account | Cart | Language -->
        <div class="header__actions">
          
          {% if section.settings.enable_customer_accounts %}
          <!-- Account -->
          <a href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}" 
             class="header__action-btn" 
             aria-label="{%- if customer -%}{{ 'customer.account_fallback' | t }}{%- else -%}{{ 'customer.log_in' | t }}{%- endif -%}">
            <svg class="header__action-icon" viewBox="0 0 20 20" aria-hidden="true">
              <path d="M10 2a4 4 0 1 0 0 8 4 4 0 0 0 0-8zM6 18a4 4 0 0 1 8 0H6z" fill="currentColor"/>
            </svg>
            <span class="header__action-text">Account</span>
          </a>
          {% endif %}

          <!-- Cart -->
          <a href="{{ routes.cart_url }}" class="header__action-btn header__cart-btn" aria-label="Cart">
            <svg class="header__action-icon" viewBox="0 0 20 20" aria-hidden="true">
              <path d="M3 1a1 1 0 0 0 0 2h1.22l.305 1.222a.997.997 0 0 0 .01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 0 0 0-2H6.414l1-1H14a1 1 0 0 0 .894-.553l2-4A1 1 0 0 0 16 5H6.28l-.31-1.243A1 1 0 0 0 5 3H3z" fill="currentColor"/>
              <circle cx="6.5" cy="17.5" r="1.5" fill="currentColor"/>
              <circle cx="14.5" cy="17.5" r="1.5" fill="currentColor"/>
            </svg>
            {% if cart != empty %}
              <span class="header__cart-count">{{ cart.item_count }}</span>
            {% endif %}
            <span class="header__action-text">Cart</span>
          </a>

          <!-- Language/Currency Selector -->
          {% if section.settings.enable_language_selector %}
            <div class="header__language-selector">
              <button class="header__action-btn header__language-btn" aria-label="Language">
                <svg class="header__action-icon" viewBox="0 0 20 20" aria-hidden="true">
                  <path d="M7 4a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v.25a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1-.5-.5V4zM7.5 7a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5h-5z" fill="currentColor"/>
                </svg>
                <span class="header__action-text">Language</span>
              </button>
            </div>
          {% endif %}

        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Layout -->
  <div class="header__mobile">
    <div class="header__mobile-container">
      
      <!-- Hamburger Menu (Left) -->
      <button class="header__mobile-toggle" aria-label="Open mobile menu" aria-expanded="false">
        <span class="hamburger">
          <span class="hamburger__line"></span>
          <span class="hamburger__line"></span>
          <span class="hamburger__line"></span>
        </span>
      </button>

      <!-- Logo (Center) -->
      <div class="header__logo header__logo--mobile">
        {% if section.settings.logo != blank %}
          <a href="{{ routes.root_url }}" class="header__logo-link">
            {%- assign logo_alt = section.settings.logo.alt | default: shop.name | escape -%}
            {%- assign logo_height = section.settings.logo_width_mobile | default: 80 | divided_by: section.settings.logo.aspect_ratio -%}
            {%- assign logo_url = section.settings.logo | image_url: width: section.settings.logo_width_mobile | default: 80 -%}
            <img 
              src="{{ logo_url }}"
              alt="{{ logo_alt }}"
              class="header__logo-image"
              width="{{ section.settings.logo_width_mobile | default: 80 }}"
              height="{{ logo_height | round }}"
              loading="eager"
            />
          </a>
        {% else %}
          <a href="{{ routes.root_url }}" class="header__logo-text">
            {{ shop.name }}
          </a>
        {% endif %}
      </div>

      <!-- Cart (Right) -->
      <a href="{{ routes.cart_url }}" class="header__cart-btn header__cart-btn--mobile" aria-label="Cart">
        <svg class="header__action-icon" viewBox="0 0 20 20" aria-hidden="true">
          <path d="M3 1a1 1 0 0 0 0 2h1.22l.305 1.222a.997.997 0 0 0 .01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 0 0 0-2H6.414l1-1H14a1 1 0 0 0 .894-.553l2-4A1 1 0 0 0 16 5H6.28l-.31-1.243A1 1 0 0 0 5 3H3z" fill="currentColor"/>
          <circle cx="6.5" cy="17.5" r="1.5" fill="currentColor"/>
          <circle cx="14.5" cy="17.5" r="1.5" fill="currentColor"/>
        </svg>
        {% if cart != empty %}
          <span class="header__cart-count">{{ cart.item_count }}</span>
        {% endif %}
      </a>

    </div>
  </div>

  <!-- Mobile Drawer Menu -->
  <div class="header__mobile-nav" id="mobile-navigation">
    <div class="header__mobile-nav-content">
      
      <div class="header__mobile-nav-header">
        <span class="header__mobile-nav-title">Menu</span>
        <button class="header__mobile-nav-close" aria-label="Close mobile menu">
          <svg viewBox="0 0 20 20" aria-hidden="true">
            <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" fill="none"/>
          </svg>
        </button>
      </div>

      <!-- Mobile Menu Order: Account → Language → Navigation Menu -->
      <div class="header__mobile-nav-menu">
        
        <!-- Account Section -->
        <div class="header__mobile-section header__mobile-section--account">
          <a href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}" 
             class="header__mobile-action">
            <svg class="header__mobile-icon" viewBox="0 0 20 20" aria-hidden="true">
              <path d="M10 2a4 4 0 1 0 0 8 4 4 0 0 0 0-8zM6 18a4 4 0 0 1 8 0H6z" fill="currentColor"/>
            </svg>
            <span>Account {%- if customer -%}({{ customer.first_name }}){%- else -%}(Sign In / Profile){%- endif -%}</span>
          </a>
        </div>

        <!-- Language Section -->
        {% if section.settings.enable_language_selector %}
          <div class="header__mobile-section header__mobile-section--language">
            <div class="header__mobile-action">
              <svg class="header__mobile-icon" viewBox="0 0 20 20" aria-hidden="true">
                <path d="M7 4a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v.25a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1-.5-.5V4z" fill="currentColor"/>
              </svg>
              <span>Language Selector</span>
            </div>
          </div>
        {% endif %}

        <!-- Separator -->
        <div class="header__mobile-separator"></div>

        <!-- Navigation Menu -->
        <nav class="header__mobile-nav-links">
          <ul class="header__mobile-nav-list">
            {%- for link in section.settings.menu.links -%}
              <li class="header__mobile-nav-item">
                {%- if link.links != blank -%}
                  <details class="header__mobile-dropdown">
                    <summary class="header__mobile-nav-link header__mobile-nav-link--dropdown">
                      Menu: {{ link.title | escape }}
                      <svg class="header__mobile-dropdown-icon" viewBox="0 0 10 6" aria-hidden="true">
                        <path d="M1 1l4 4 4-4" stroke="currentColor" stroke-width="1.5" fill="none"/>
                      </svg>
                    </summary>
                    <div class="header__mobile-dropdown-content">
                      <ul class="header__mobile-dropdown-list">
                        {%- for childlink in link.links -%}
                          <li>
                            <a href="{{ childlink.url }}" class="header__mobile-dropdown-link{% if childlink.current %} header__mobile-dropdown-link--active{% endif %}">
                              {{ childlink.title | escape }}
                            </a>
                          </li>
                        {%- endfor -%}
                      </ul>
                    </div>
                  </details>
                {%- else -%}
                  <a href="{{ link.url }}" class="header__mobile-nav-link{% if link.current %} header__mobile-nav-link--active{% endif %}">
                    Menu: {{ link.title | escape }}
                  </a>
                {%- endif -%}
              </li>
            {%- endfor -%}
          </ul>
        </nav>
      </div>
    </div>
  </div>

  <div class="header__mobile-nav-overlay"></div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const mobileToggle = document.querySelector('.header__mobile-toggle');
    const mobileNav = document.querySelector('.header__mobile-nav');
    const mobileNavClose = document.querySelector('.header__mobile-nav-close');
    const mobileNavOverlay = document.querySelector('.header__mobile-nav-overlay');
    const body = document.body;

    function openMobileNav() {
      if (mobileNav) {
        mobileNav.classList.add('header__mobile-nav--open');
        body.classList.add('header__mobile-nav-open');
        mobileToggle.setAttribute('aria-expanded', 'true');
      }
    }

    function closeMobileNav() {
      if (mobileNav) {
        mobileNav.classList.remove('header__mobile-nav--open');
        body.classList.remove('header__mobile-nav-open');
        mobileToggle.setAttribute('aria-expanded', 'false');
      }
    }

    if (mobileToggle && mobileNav) {
      mobileToggle.addEventListener('click', openMobileNav);
      if (mobileNavClose) {
        mobileNavClose.addEventListener('click', closeMobileNav);
      }
      if (mobileNavOverlay) {
        mobileNavOverlay.addEventListener('click', closeMobileNav);
      }

      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && mobileNav.classList.contains('header__mobile-nav--open')) {
          closeMobileNav();
        }
      });
    }
  });
</script>

{% schema %}
{
  "name": "Header",
  "class": "section-header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 250,
      "step": 10,
      "default": 100,
      "unit": "px",
      "label": "Desktop logo width"
    },
    {
      "type": "range",
      "id": "logo_width_mobile",
      "min": 50,
      "max": 150,
      "step": 10,
      "default": 80,
      "unit": "px",
      "label": "Mobile logo width"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Menu"
    },
    {
      "type": "header",
      "content": "Search Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_search",
      "default": true,
      "label": "Show search"
    },
    {
      "type": "text",
      "id": "search_placeholder",
      "default": "Search products...",
      "label": "Search placeholder text"
    },
    {
      "type": "header",
      "content": "Navigation Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_language_selector",
      "default": true,
      "label": "Show language selector"
    },
    {
      "type": "checkbox",
      "id": "enable_customer_accounts",
      "default": true,
      "label": "Show customer account link"
    },
    {
      "type": "header",
      "content": "Header Behavior"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_header",
      "default": true,
      "label": "Enable sticky header"
    },
    {
      "type": "select",
      "id": "header_transparency",
      "label": "Header transparency",
      "default": "solid",
      "options": [
        {
          "value": "solid",
          "label": "Solid"
        },
        {
          "value": "semi_transparent",
          "label": "Semi-transparent"
        },
        {
          "value": "transparent",
          "label": "Transparent"
        }
      ]
    },
    {
      "type": "header",
      "content": "Top Bar Settings"
    },
    {
      "type": "text",
      "id": "announcement_text",
      "label": "Announcement text (optional)"
    },
    {
      "type": "url",
      "id": "announcement_link",
      "label": "Announcement link (optional)"
    },
    {
      "type": "checkbox",
      "id": "show_top_bar",
      "default": true,
      "label": "Show top navigation bar"
    },
    {
      "type": "header",
      "content": "Spacing & Layout"
    },
    {
      "type": "range",
      "id": "header_height",
      "min": 60,
      "max": 120,
      "step": 5,
      "default": 80,
      "unit": "px",
      "label": "Header height"
    },
    {
      "type": "range",
      "id": "top_bar_height",
      "min": 30,
      "max": 60,
      "step": 2,
      "default": 44,
      "unit": "px",
      "label": "Top bar height"
    },
    {
      "type": "select",
      "id": "search_width",
      "label": "Search bar width",
      "default": "medium",
      "options": [
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ]
    },
    {
      "type": "header",
      "content": "Colors & Styling"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "background-1"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent color (cart badge, highlights)",
      "default": "#3b82f6"
    },
    {
      "type": "checkbox",
      "id": "enable_shadow",
      "default": true,
      "label": "Enable header shadow"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "font_size_navigation",
      "min": 12,
      "max": 18,
      "step": 1,
      "default": 14,
      "unit": "px",
      "label": "Navigation font size"
    },
    {
      "type": "select",
      "id": "font_weight_navigation",
      "label": "Navigation font weight",
      "default": "500",
      "options": [
        {
          "value": "400",
          "label": "Normal"
        },
        {
          "value": "500",
          "label": "Medium"
        },
        {
          "value": "600",
          "label": "Semi-bold"
        },
        {
          "value": "700",
          "label": "Bold"
        }
      ]
    }
  ]
}
{% endschema %}